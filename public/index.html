<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chat + Funrooms</title>
  <link href="slogow.png" rel="icon" type="image/png"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: dark; }
    body { font-family: "Courier New", monospace; background:#000; color:#fff; margin:0; }
    section { display:none; min-height:100vh; padding:16px; box-sizing:border-box; }
    .active { display:block !important; }
    input, button, select { font-family:inherit; background:#000; color:#fff; border:1px solid #fff; padding:10px 12px; }
    button { cursor:pointer; }
    .cards { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin:16px 0; }
    .card { border:1px solid #fff; padding:14px 18px; cursor:pointer; }

    /* Layout: game on top, chat below */
    #gameArea { max-width: 980px; margin: 0 auto; display:flex; flex-direction:column; gap:12px; }
    #gameHeader { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    #gameInfo { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
    #canvasWrap { display:flex; justify-content:center; }
    canvas { image-rendering: pixelated; border:1px solid #444; background:#111; }

    /* Chat full screen */
    #chat, #chatFun {
      width: 100%;
      height: 100vh;
      border: 1px solid #fff;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-sizing: border-box;
    }

    #messages, #messagesFun {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #333;
      padding: 0;
      margin: 0;
      list-style: none;
    }

    #messages li, #messagesFun li { padding:8px 10px; border-bottom:1px solid #222; text-align:left; }
    #messages li.me, #messagesFun li.me { text-align:right; }

    #form, #formFun {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #form input, #formFun input { flex: 1; }

    #leaveBtn, #leaveFunBtn {
      width: 100%;
      margin-top: 6px;
    }

    .typing { opacity:.8; font-size:.9rem; min-height:1.2em; text-align:left; }

    /* File preview styling */
    .file-preview {
      border: 1px solid #555;
      padding: 6px;
      margin: 6px 0;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .file-preview.active { border-color: #0f0; }
    .remove-btn {
      background: transparent;
      border: none;
      color: #f55;
      font-size: 1rem;
      cursor: pointer;
    }
    .remove-btn:hover { color: #f00; }

    @media (max-width:768px) {
      input,button,select { width:100%; font-size:.95rem; }
      #gameHeader { flex-direction:column; align-items:flex-start; gap:8px; }
    }
  </style>
</head>
<body>
  <!-- Join -->
  <section id="joinScreen" class="active">
    <h1>Join</h1>
    <form id="joinForm">
      <input id="joinName" placeholder="Enter your name" required />
      <button type="submit">Enter</button>
    </form>
  </section>

  <!-- Menu -->
  <section id="menuScreen">
    <h1>Choose</h1>
    <div class="cards">
      <div class="card" id="randomBtn">Random Group Chat</div>
      <div class="card" id="createBtn">Create Chatroom</div>
      <div class="card" id="joinBtn">Join Chatroom</div>
      <div class="card" id="createFunBtn">Create Funroom</div>
      <div class="card" id="joinFunBtn">Join Funroom</div>
    </div>

    <!-- Create Chat -->
    <div id="createForm" style="display:none; margin-top:16px;">
      <input id="newRoomName" placeholder="Room name"/>
      <input id="newRoomPass" placeholder="Password"/>
      <button id="createRoomBtn">Create</button>
    </div>

    <!-- Join Chat -->
    <div id="joinForm2" style="display:none; margin-top:16px;">
      <h3>Available Chatrooms</h3>
      <select id="roomDropdown" style="min-width:240px;">
        <option value="">-- Select a room --</option>
      </select>
      <input id="joinPass" placeholder="Password" style="margin-top:10px;"/>
      <button id="joinRoomBtn">Join</button>
    </div>

    <!-- Create Funroom -->
    <div id="createFunForm" style="display:none; margin-top:16px;">
      <h3>Create Funroom</h3>
      <input id="newFunName" placeholder="Funroom name"/>
      <input id="newFunPass" placeholder="Password (optional)"/>
      <label>
        Fun Mode:
        <select id="funMode">
          <option value="snake">Snake</option>
        </select>
      </label>
      <label style="margin-left:12px;">
        <input type="checkbox" id="timer60"/> 60s Timer
      </label>
      <button id="createFunroomBtn">Create</button>
    </div>

    <!-- Join Funroom -->
    <div id="joinFunForm" style="display:none; margin-top:16px;">
      <h3>Join Funroom (shows rooms with exactly one player)</h3>
      <select id="funDropdown" style="min-width:240px;">
        <option value="">-- Select a funroom --</option>
      </select>
      <input id="joinFunPass" placeholder="Password (if any)" style="margin-top:10px;"/>
      <button id="joinFunroomBtn">Join</button>
    </div>
  </section>

  <!-- Funroom (Game + Chat) -->
  <section id="funScreen">
    <div id="gameArea">
      <div id="gameHeader">
        <div id="gameInfo">
          <strong id="roomTitle"></strong>
          <span id="roleBadge"></span>
          <span id="scoreP1"></span>
          <span id="scoreP2"></span>
          <span id="timerLabel"></span>
          <span id="spectators"></span>
        </div>
        <div>
          <button id="playAgainBtn">Play Again</button>
          <label style="margin-left:8px;">
            <input type="checkbox" id="timer60Replay"/> 60s Timer
          </label>
          <button id="leaveFunBtn" style="margin-left:8px;">Leave</button>
        </div>
      </div>

      <div id="canvasWrap">
        <canvas id="board" width="720" height="480"></canvas>
      </div>

      <!-- Chat below the game -->
      <div id="chatFun">
        <ul id="messagesFun"></ul>
        <div class="typing" id="typingIndicatorFun"></div>

        <form id="formFun">
          <label class="file-label" for="fileInputFun">Attach</label>
          <input id="fileInputFun" type="file" accept="image/*,.txt"/>
          <input id="inputFun" placeholder="Type message..."/>
          <button id="sendFun" type="submit">Send</button>
        </form>

        <div id="filePreviewFun" class="file-preview" style="display:none;">
          <span id="fileNameFun"></span>
          <button type="button" id="removeFileBtnFun" class="remove-btn">❌</button>
        </div>

        <button id="leaveFunBtn">Leave Funroom</button>
      </div>
    </div>
  </section>

  <!-- Normal chat screen -->
  <section id="chatScreen" style="display:none;">
    <div id="chat">
      <ul id="messages"></ul>
      <div class="typing" id="typingIndicator"></div>

      <form id="form">
        <label class="file-label" for="fileInput">Attach</label>
        <input id="fileInput" type="file" accept="image/*,.txt"/>
        <input id="input" placeholder="Type message..."/>
        <button id="send" type="submit">Send</button>
      </form>

      <div id="filePreview" class="file-preview" style="display:none;">
        <span id="fileName"></span>
        <button type="button" id="removeFileBtn" class="remove-btn">❌</button>
      </div>

      <button id="leaveBtn">Leave Chatroom</button>
    </div>
  </section>

  <script src="/socket.io/socket.io.js"></script>
  <script src="client.js"></script>
</body>
</html>
